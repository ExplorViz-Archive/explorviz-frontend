image: node:13.14.0-alpine

cache:
  paths:
    - node_modules/
  
before_script:
  - npm install  
  - npm install -g ember-cli
  # install chrome for testing
  - apk update && apk add --no-cache nmap && \
    echo @edge http://nl.alpinelinux.org/alpine/edge/community >> /etc/apk/repositories && \
    echo @edge http://nl.alpinelinux.org/alpine/edge/main >> /etc/apk/repositories && \
    apk update && \
    apk add --no-cache \
      chromium \
      harfbuzz \
      "freetype>2.8" \
      ttf-freefont \
      nss

test:
  stage: test
  tags:
    - exec-docker
  script: ember test

# - stage: deploy
#    if: (type = push) AND ((branch = dev-1) OR (branch = master))
#    skip_cleanup: false
#    env:
#      - EMBER_VERSION=release
#    script: ember build --prod && chmod +x .travis/docker_push.sh && .travis/docker_push.sh
