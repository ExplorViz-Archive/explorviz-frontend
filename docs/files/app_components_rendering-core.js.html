<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>app/components/rendering-core.js - ExplorViz: UI Frontend API</title>
    <link rel="stylesheet" href="">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="stylesheet" href="../assets/css/custom.css">
    <link rel="stylesheet" href="../assets/vendor/bootstrap/css/bootstrap.css">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
</head>
<body class="yui3-skin-sam">
<div class="navbar navbar-fixed-top">
    <div class="navbar-inner">
        <h1 class="brand" style="padding: 10px 16px 10px; height: 20px; line-height: 20px; margin-left: 0;">
	    <img alt="ExplorViz: UI Frontend API" src="https://www.explorviz.net/img/favicon.png" style="max-height: 65%;" title="ExplorViz: UI Frontend API">
            ExplorViz: UI Frontend API
        </h1>
	<div class="nav">
            <li class="divider-vertical"></li>
            <li>
                <p class="navbar-text">
                    API Docs for Version: <b>0.0.1</b>
                </p>
            </li>
        </div>
        <form class="navbar-form pull-right" style="line-height: 40px; height: 40px;">
            <input style="margin-top: 0;" type="text" class="search-query" placeholder="Search for classes/modules..." data-obj='["classes/Application", "classes/Application-Rendering", "classes/Authenticator", "classes/BaseEntity", "classes/Clazz", "classes/Communication", "classes/CommunicationClazz", "classes/Component", "classes/Draw3DNodeEntity", "classes/DrawEdgeEntity", "classes/DrawNodeEntity", "classes/Landscape", "classes/Landscape-Rendering", "classes/Node", "classes/NodeGroup", "classes/Rendering-Core", "classes/System"]'>
        </form>
    </div>
</div>
<div class="container">
    <div class="row">
        <div class="span3">
	    <div>
	        <h3>APIs</h3>
	        <div id="sidebar">
	            <ul id="main-nav" class="nav nav-tabs" style="margin-bottom:0;">
	                <li class="active"><a href="#classes" data-toggle="tab">Classes</a></li>
	                <li><a href="#modules" data-toggle="tab">Modules</a></li>
	            </ul>
	    
	            <div id="api-tabview-filter">
	                <input type="search" placeholder="Type to filter APIs">
	            </div>
	    
	            <div class="tab-content" style="border: 1px solid #DDD; border-top:0;">
	                <div class="tab-pane active" id="classes">
	                    <ul id="api-classes" class="nav nav-list">
	                            <li><a href="../classes/Application.html">Application</a></li>
	                            <li><a href="../classes/Application-Rendering.html">Application-Rendering</a></li>
	                            <li><a href="../classes/Authenticator.html">Authenticator</a></li>
	                            <li><a href="../classes/BaseEntity.html">BaseEntity</a></li>
	                            <li><a href="../classes/Clazz.html">Clazz</a></li>
	                            <li><a href="../classes/Communication.html">Communication</a></li>
	                            <li><a href="../classes/CommunicationClazz.html">CommunicationClazz</a></li>
	                            <li><a href="../classes/Component.html">Component</a></li>
	                            <li><a href="../classes/Draw3DNodeEntity.html">Draw3DNodeEntity</a></li>
	                            <li><a href="../classes/DrawEdgeEntity.html">DrawEdgeEntity</a></li>
	                            <li><a href="../classes/DrawNodeEntity.html">DrawNodeEntity</a></li>
	                            <li><a href="../classes/Landscape.html">Landscape</a></li>
	                            <li><a href="../classes/Landscape-Rendering.html">Landscape-Rendering</a></li>
	                            <li><a href="../classes/Node.html">Node</a></li>
	                            <li><a href="../classes/NodeGroup.html">NodeGroup</a></li>
	                            <li><a href="../classes/Rendering-Core.html">Rendering-Core</a></li>
	                            <li><a href="../classes/System.html">System</a></li>
	                    </ul>
	                </div>
	    
	                <div class="tab-pane" id="modules">
	                    <ul id="api-modules" class="nav nav-list">
	                    </ul>
	                </div>
	            </div>
	        </div>
	    </div>
        </div>
        <div class="span9">
                <form id="options-form" class="form-inline pull-right">
                    Show:
                    <label for="api-show-inherited" class="checkbox">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected" class="checkbox">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private" class="checkbox">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated" class="checkbox">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </form>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<div class="page-header">
    <h1>app/components/rendering-core.js <small>File</small></h1>
</div>

<div class="file">
    <pre class="prettyprint linenums">
import Ember from &#x27;ember&#x27;;

/**
* This component contains the core mechanics of the different (three.js-based) 
* renderer. All functions below are called in a determined order, hence you only 
* need to override them in your custom renderer.
*
* See {{#crossLink &quot;Landscape-Rendering&quot;}}{{/crossLink}} or 
* {{#crossLink &quot;Application-Rendering&quot;}}{{/crossLink}} for example usage.
*
* Call order:
*
* 1. 
*
* @class Rendering-Core
* @extends Ember.Component
*/
export default Ember.Component.extend({

  classNames: [&#x27;viz&#x27;],

  landscapeUpdater: Ember.inject.service(&quot;landscape-reload&quot;),  
  store: Ember.inject.service(),  

  scene : null,
  webglrenderer: null,
  camera: null,

  canvas: null,

  entity: null,

  font: null,
  animationFrameId: null,

  landscape: Ember.computed(&quot;landscapeUpdater.object.timestamp&quot;, function() {
    return this.get(&#x27;landscapeUpdater.object&#x27;);
  }),  

  observer: Ember.observer(&quot;landscape&quot;, function(){
    this.set(&quot;entity&quot;, this.get(&quot;landscape&quot;));
    this.preProcessEntity();
    this.cleanAndUpdateScene(this.get(&quot;entity&quot;));
  }),


  // @Override
  didRender(){
    this._super(...arguments);

    this.initRendering();
  },


  // @Override
  didDestroyElement() {
    this._super(...arguments);
    this.cleanup();    
  },

  /**
   * This function is called once on the didRender event. Inherit this function 
   * to call other important function, e.g. initInteraction as shown in 
   * {@landscape-rendering}.
   *
   * @method initRendering
   */
  initRendering() {

    const self = this;

    // get size if outer ember div
    const height = this.$()[0].clientHeight;
    const width = this.$()[0].clientWidth;
    
    const canvas = this.$(&#x27;#threeCanvas&#x27;)[0];

    this.set(&#x27;canvas&#x27;, canvas);

    this.set(&#x27;scene&#x27;, new THREE.Scene());
    this.set(&#x27;scene.background&#x27;, new THREE.Color(0xffffff));

    this.set(&#x27;camera&#x27;, new THREE.PerspectiveCamera(75, width / height, 0.1, 1000));

    this.set(&#x27;webglrenderer&#x27;, new THREE.WebGLRenderer({
      antialias: true,  
      canvas: canvas
    }));
    this.get(&#x27;webglrenderer&#x27;).setSize(width, height);

    // Rendering loop //

    function render() {
      const animationId = requestAnimationFrame(render);
      self.set(&#x27;animationFrameId&#x27;, animationId);
      self.get(&#x27;webglrenderer&#x27;).render(self.get(&#x27;scene&#x27;), self.get(&#x27;camera&#x27;));
    }

    render();

    this.get(&quot;landscape&quot;); //useless, but very important for working observer

    this.set(&#x27;entity&#x27;, this.get(&#x27;renderingModel&#x27;));

    ////////////////////

    // load font for labels and proceed with populating the scene
    new THREE.FontLoader().load(&#x27;three.js/fonts/helvetiker_regular.typeface.json&#x27;, (font) =&gt; {

      self.set(&#x27;font&#x27;, font);
      self.populateScene();

    });    

  },


  /**
   * This function is called once on initRendering. Inherit this function to 
   * insert objects in the Three.js scene. Have a look 
   * at {{#crossLink &quot;Landscape-Rendering&quot;}}{{/crossLink}} for an example.
   *
   * @method populateScene
   */
  populateScene() {},


  /**
   * This function is called when the destroy event is fired. Inherit this 
   * function to cleanup custom properties or unbind listener 
   * as shown in {{#crossLink &quot;Landscape-Rendering&quot;}}{{/crossLink}}.
   *
   * @method cleanup
   */
  cleanup() {
    cancelAnimationFrame(this.get(&#x27;animationFrameId&#x27;));

    this.set(&#x27;scene&#x27;, null);
    this.set(&#x27;webglrenderer&#x27;, null);
    this.set(&#x27;camera&#x27;, null);
  },



  /**
   * Inherit this function to update the scene with a new renderingModel. It 
   * automatically removes every mesh from the scene. Add your custom code 
   * as shown in landscape-rendering.
   *
   * @method cleanAndUpdateScene
   */
  cleanAndUpdateScene(entity) {
    this.set(&#x27;entity&#x27;, entity);
    const scene = this.get(&#x27;scene&#x27;);

    for (let i = scene.children.length - 1; i &gt;= 0 ; i--) {
      let child = scene.children[i];

      if ( child.type !== &#x27;AmbientLight&#x27; &amp;&amp; child.type !== &#x27;SpotLight&#x27; ) {
        scene.remove(child);
      }
    }
  },


  /**
   * This function is called automatically when a new landscape was fetched. It 
   * is executed before 
   * {{#crossLink &quot;Rendering-Core/cleanAndUpdateScene:method&quot;}}{{/crossLink}}.
   * Inherit this function to preprocess the 
   * {{#crossLink &quot;Landscape&quot;}}{{/crossLink}} for rendering, e.g. filter some 
   * value.
   *
   * See {{#crossLink &quot;Application-Rendering&quot;}}{{/crossLink}} for example usage.
   *
   * @method preProcessEntity
   */
  preProcessEntity() {}

});

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/jquery/jquery-1.8.2.min.js"></script>
<script src="../assets/vendor/bootstrap/js/bootstrap.js"></script>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script src="../assets/js/yuidoc-bootstrap.js"></script>
<script>prettyPrint();</script>
</body>
</html>
