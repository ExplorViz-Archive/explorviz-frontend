var THREEx=THREEx||{};THREEx.DynamicTexture=function(t,e){var i=document.createElement("canvas");i.width=t,i.height=e,this.canvas=i;var n=i.getContext("2d");this.context=n;var a=new THREE.Texture(i);this.texture=a},THREEx.DynamicTexture.prototype.clear=function(t){return void 0!==t?(this.context.fillStyle=t,this.context.fillRect(0,0,this.canvas.width,this.canvas.height)):this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.texture.needsUpdate=!0,this},THREEx.DynamicTexture.prototype.drawText=function(t,e,i,n,a){if(void 0!==a&&(this.context.font=a),void 0===e||null===e){var r=this.context.measureText(t);e=(this.canvas.width-r.width)/2}return this.context.fillStyle=n,this.context.fillText(t,e,i),this.texture.needsUpdate=!0,this},THREEx.DynamicTexture.prototype.drawTextCooked=function(t){var e=this.context,i=this.canvas,n=(t=t||{}).text,a={margin:void 0!==t.margin?t.margin:.1,lineHeight:void 0!==t.lineHeight?t.lineHeight:.1,align:void 0!==t.align?t.align:"left",fillStyle:void 0!==t.fillStyle?t.fillStyle:"black",font:void 0!==t.font?t.font:"bold 102.4px Arial"};console.assert("string"==typeof n),e.save(),e.fillStyle=a.fillStyle,e.font=a.font;for(var r=(a.lineHeight+a.margin)*i.height;n.length>0;){var h=function(t){for(var n="",r=(1-2*a.margin)*i.width;n.length!==t.length&&!(e.measureText(n).width>r);)n+=t.substr(n.length,1);return n}(n);n=n.substr(h.length);var l=e.measureText(h);if("left"===a.align)s=a.margin*i.width;else if("right"===a.align)s=(1-a.margin)*i.width-l.width;else if("center"===a.align)var s=(i.width-l.width)/2;else console.assert(!1);this.context.fillText(h,s,r),r+=a.lineHeight*i.height}return e.restore(),this.texture.needsUpdate=!0,this},THREEx.DynamicTexture.prototype.drawImage=function(){return this.context.drawImage.apply(this.context,arguments),this.texture.needsUpdate=!0,this};