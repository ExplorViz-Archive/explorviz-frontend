---
language: node_js

node_js:
  - "6"

services:
  - docker

sudo: false

# For testing environment
addons:
  chrome: stable

branches:
  only:
  - master
  - /^greenkeeper/.*$/
  - dev-1

env:
  global:
    # See https://git.io/vdao3 for details.
    #- JOBS=1
  matrix:
    - EMBER_TRY_SCENARIO=ember-lts-2.12
    - EMBER_TRY_SCENARIO=ember-lts-2.16
    - EMBER_TRY_SCENARIO=ember-lts-2.18
    - EMBER_TRY_SCENARIO=ember-lts-3.4.7
    - EMBER_TRY_SCENARIO=ember-3.5.0

matrix:
  fast_finish: true
  allow_failures:
    - env: EMBER_TRY_SCENARIO=ember-lts-2.12

before_script:
  - chmod +x .travis/push.sh

before_install:
#  - if [[ `npm -v` != 5.6.0 ]]; then npm i -g npm@5.6.0; fi

install:
  - npm install --no-package-lock

script:
  - ember try:one $EMBER_TRY_SCENARIO

after_success:
  - test $TRAVIS_BRANCH = "master" && .travis/push.sh
deploy:
  - provider: script
    script: chmod +x .travis/docker_push_latest.sh && .travis/docker_push_latest.sh
    on:
      branch: master
      condition: $EMBER_TRY_SCENARIO = ember-lts-3.4.7
  - provider: script
    script: chmod +x .travis/docker_push_dev.sh && .travis/docker_push_dev.sh
    on:
      branch: dev-1
      condition: $EMBER_TRY_SCENARIO = ember-lts-3.4.7