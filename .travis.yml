---
language: node_js

node_js:
  - "6"

services:
  - docker

sudo: false

# For testing environment
addons:
  chrome: stable

branches:
  only:
  - master
  - /^greenkeeper/.*$/
  - dev-1

env:
  matrix:
    - EMBER_TRY_SCENARIO=ember-lts-2.16
    - EMBER_TRY_SCENARIO=ember-lts-2.18
    - EMBER_TRY_SCENARIO=ember-lts-3.4.7
    - EMBER_TRY_SCENARIO=ember-3.5.0
  allow_failures:
    - EMBER_TRY_SCENARIO=ember-lts-2.12

jobs:
  fast_finish: true
  include:
    - stage: test
      script: ember try:one $EMBER_TRY_SCENARIO
    - stage: deploy
      if: (branch = dev-1) OR (branch = master)
      skip_cleanup: true
      env:
        - $EMBER_TRY_SCENARIO = ember-lts-3.4.7
      script: chmod +x .travis/docker_push.sh && .travis/docker_push.sh

install:
  - npm install --no-package-lock

#before_script:
#  - chmod +x .travis/push.sh

#after_success:
#  - test $TRAVIS_BRANCH = "master" && .travis/push.sh